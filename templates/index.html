<div id="asciiOutput"></div>

<!-- JS download logic -->
<script>
  const pcBtn = document.getElementById('pcMode');
  const mobileBtn = document.getElementById('mobileMode');
  const body = document.body;

  function setMode(mode) {
    if (mode === 'mobile') {
      body.classList.add('mobile-mode');
      pcBtn.classList.remove('active');
      pcBtn.setAttribute('aria-pressed', 'false');
      mobileBtn.classList.add('active');
      mobileBtn.setAttribute('aria-pressed', 'true');
    } else {
      body.classList.remove('mobile-mode');
      mobileBtn.classList.remove('active');
      mobileBtn.setAttribute('aria-pressed', 'false');
      pcBtn.classList.add('active');
      pcBtn.setAttribute('aria-pressed', 'true');
    }
  }

  pcBtn.addEventListener('click', () => setMode('pc'));
  mobileBtn.addEventListener('click', () => setMode('mobile'));

  const form = document.getElementById('uploadForm');
  const asciiOutput = document.getElementById('asciiOutput');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    const formData = new FormData(form);
    asciiOutput.innerHTML = 'Processing...';

    try {
      const response = await fetch('/upload', {
        method: 'POST',
        body: formData
      });
      const html = await response.text();
      asciiOutput.innerHTML = html;
    } catch (err) {
      asciiOutput.textContent = 'Error uploading image.';
    }
  });

  function downloadAscii() {
    const textArea = document.getElementById('asciiText');
    if (!textArea) return alert('No ASCII to download!');
    const blob = new Blob([textArea.value], { type: 'text/plain' });
    const link = document.createElement('a');
    link.download = 'ascii-art.txt';
    link.href = URL.createObjectURL(blob);
    link.click();
    URL.revokeObjectURL(link.href);
  }
</script>
